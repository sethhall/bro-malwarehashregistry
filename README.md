Integrate Bro with Team Cymru's Malware Hash Registry
=====================================================

Detect file transfers matching malware hashes found in [Team Cymru's Malware
Hash Registry](https://www.team-cymru.com/mhr.html). This script is starting
as a near direct copy of the same script from Bro. The intent over time will
be to remove the script from Bro and continue development here.

Background
==========

When Team Cymru originally announced the Malware Hash Registry in October 
2008, I read about their new service on a mailing list. What made it most 
particularly appealing was that it offered a DNS look up interface because 
Bro can perform DNS lookups dynamically at runtime! I immediately set to 
work figuring out how to make Bro match Windows executables against the 
Malware Hash Registry. At the time Bro didn't have any ability to hash file 
contents so I had to add that to Bro's core with a short patch. After that, 
the script to do the matching was possible so I wrote that quickly too. In 
total, it only took 23 hours from their announcement until we were matching 
live traffic for malware with Bro.

This script became part of Bro with Bro 2.0 and now that it's a Bro package 
here, this is the first step of the script being broken back out of Bro.

During it's lifetime in Bro, there was more work done on it to expand the file 
types that it will attempt to query against the registry, perfomance 
improvements, and it was rewritten to use the file analysis framework. In 
some ways, this script was what prompted the development of the file 
analysis framework and the generic handling of files in Bro.

Configuration
=============

This script doesn't require any configuration out of the box.

What to expect from the script
==============================

Notices
-------

`TeamCymruMalwareHashRegistry::Match` - This will fire whenever the the 
service indicates the percentage of malware scanners indicating a "bad" file 
exceeds the default of `70%`.

Log
---

`malwarehashregistry` - This log will contain the results of all positive 
look ups performed against the malware hash registry and the results from 
the lookups. It's more extensive than the notices because it doesn't care 
about the detection rate. Any lookup with a positive match in it will result 
in a log entry.

Note
====

Due to this being a script pulled from Bro, you must make sure that you 
aren't loading the equivalent script from Bro 
(`frameworks/files/detect-MHR.bro`) because it will cause conflicts and 
Bro won't start up.
